# Firebase Database Schema - FoodWaste App

## Collections Structure

### 1. users (Collection)
เก็บข้อมูลผู้ใช้งาน

**Document ID**: `{userId}` (Auto-generated by Firebase Auth)

**Fields**:
```javascript
{
  userId: string,              // Firebase Auth UID
  username: string,            // ชื่อผู้ใช้ (unique)
  email: string,               // อีเมล
  phoneNumber: string,         // เบอร์โทรศัพท์
  profileImage: string | null, // URL รูปโปรไฟล์
  createdAt: timestamp,        // วันที่สร้างบัญชี
  updatedAt: timestamp,        // วันที่อัปเดตข้อมูลล่าสุด
}
```

**Indexes**:
- username (Ascending)
- email (Ascending)

**Security Rules**:
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /users/{userId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
```

---

## ER Diagram (Text Format)

```
┌─────────────────────────────────────┐
│             USERS                    │
├─────────────────────────────────────┤
│ PK  userId (string)                 │
│     username (string) [unique]      │
│     email (string) [unique]         │
│     phoneNumber (string)            │
│     profileImage (string | null)    │
│     createdAt (timestamp)           │
│     updatedAt (timestamp)           │
└─────────────────────────────────────┘
```

---

## Future Collections (สำหรับขยายระบบ)

### 2. food_items (Collection)
เก็บข้อมูลรายการอาหาร

**Fields**:
```javascript
{
  foodId: string,              // รหัสอาหาร
  userId: string,              // FK -> users.userId
  name: string,                // ชื่ออาหาร
  category: string,            // หมวดหมู่
  quantity: number,            // จำนวน
  unit: string,                // หน่วย (กก., ชิ้น, ฯลฯ)
  expiryDate: timestamp,       // วันหมดอายุ
  status: string,              // สถานะ (fresh, near_expiry, expired)
  imageUrl: string | null,     // URL รูปภาพอาหาร
  createdAt: timestamp,
  updatedAt: timestamp,
}
```

### 3. donations (Collection)
เก็บข้อมูลการบริจาค

**Fields**:
```javascript
{
  donationId: string,          // รหัสการบริจาค
  donorId: string,             // FK -> users.userId (ผู้บริจาค)
  recipientId: string | null,  // FK -> users.userId (ผู้รับ)
  foodItemId: string,          // FK -> food_items.foodId
  status: string,              // สถานะ (pending, accepted, completed, cancelled)
  pickupLocation: {            // สถานที่รับ
    address: string,
    latitude: number,
    longitude: number,
  },
  pickupTime: timestamp,       // เวลานัดรับ
  createdAt: timestamp,
  updatedAt: timestamp,
}
```

### 4. notifications (Collection)
เก็บข้อมูลการแจ้งเตือน

**Fields**:
```javascript
{
  notificationId: string,      // รหัสการแจ้งเตือน
  userId: string,              // FK -> users.userId
  type: string,                // ประเภท (expiry_warning, donation_request, etc.)
  title: string,               // หัวข้อ
  message: string,             // ข้อความ
  isRead: boolean,             // อ่านแล้วหรือยัง
  relatedId: string | null,    // ID ที่เกี่ยวข้อง (foodId, donationId, etc.)
  createdAt: timestamp,
}
```

---

## Relationships

```
USERS (1) ──┬──< (N) FOOD_ITEMS
            │
            ├──< (N) DONATIONS (as donor)
            │
            ├──< (N) DONATIONS (as recipient)
            │
            └──< (N) NOTIFICATIONS

FOOD_ITEMS (1) ───< (N) DONATIONS
```

---

## Storage Structure (Firebase Storage)

```
storage/
├── profile_images/
│   └── {userId}/
│       └── profile.jpg
└── food_images/
    └── {foodId}/
        └── image.jpg
```

---

## Authentication

**Firebase Authentication** จะจัดการ:
- การสร้างบัญชี (Email/Password)
- การเข้าสู่ระบบ
- การรีเซ็ตรหัสผ่าน
- Token management

**User Data Flow**:
1. สมัครสมาชิก → Firebase Auth สร้าง userId
2. บันทึกข้อมูลเพิ่มเติม → Firestore users collection
3. เข้าสู่ระบบ → Firebase Auth verify → ดึงข้อมูลจาก Firestore

---

## API Endpoints (ถ้าต้องการขยายเป็น Cloud Functions)

### Users
- `POST /api/users` - สร้างผู้ใช้ใหม่
- `GET /api/users/{userId}` - ดึงข้อมูลผู้ใช้
- `PUT /api/users/{userId}` - อัปเดตข้อมูลผู้ใช้
- `DELETE /api/users/{userId}` - ลบบัญชีผู้ใช้

### Food Items
- `POST /api/food-items` - เพิ่มรายการอาหาร
- `GET /api/food-items` - ดึงรายการอาหารทั้งหมด
- `GET /api/food-items/{foodId}` - ดึงรายการอาหารเฉพาะ
- `PUT /api/food-items/{foodId}` - อัปเดตรายการอาหาร
- `DELETE /api/food-items/{foodId}` - ลบรายการอาหาร

### Donations
- `POST /api/donations` - สร้างการบริจาค
- `GET /api/donations` - ดึงรายการบริจาคทั้งหมด
- `PUT /api/donations/{donationId}` - อัปเดตสถานะการบริจาค
